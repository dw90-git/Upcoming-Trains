<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Train Tracker - Enhanced with Debug Tools</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <header class="header">
            <h1>Train Tracker</h1>
            <p class="subtitle">Live train data with comprehensive debugging tools</p>
        </header>

        <!-- Tab Navigation -->
        <div class="tab-navigation">
            <button class="tab-button tab-button--active" data-tab="main">Train Search</button>
            <button class="tab-button" data-tab="debug">Debug Tools</button>
        </div>

        <!-- Main Tab Content -->
        <div id="main-tab" class="tab-content tab-content--active">
            <main class="main-content">
                <!-- API Access Method Selection -->
                <div class="card api-method-card">
                    <div class="card__header">
                        <h3>API Access Method</h3>
                    </div>
                    <div class="card__body">
                        <div class="form-group">
                            <label for="api-method" class="form-label">Choose how to access train data:</label>
                            <select id="api-method" class="form-control">
                                <option value="direct">Direct API (may be blocked by CORS)</option>
                                <option value="proxy1">CORS Proxy 1 (cors-anywhere)</option>
                                <option value="proxy2" selected>CORS Proxy 2 (allorigins) - WORKING</option>
                                <option value="proxy3">CORS Proxy 3 (codetabs)</option>
                                <option value="sample">Sample Data (for testing)</option>
                            </select>
                        </div>
                        <div class="data-source-indicator">
                            <span id="data-source-status" class="status status--info">Ready to search</span>
                            <span id="last-update" class="last-update"></span>
                        </div>
                    </div>
                </div>

                <!-- Station Selection -->
                <div class="card station-card">
                    <div class="card__header">
                        <h3>Select Journey</h3>
                    </div>
                    <div class="card__body">
                        <div class="journey-inputs">
                            <div class="station-input-group">
                                <label for="from-station" class="form-label">From</label>
                                <div class="station-autocomplete">
                                    <input type="text" id="from-station" class="form-control station-input" 
                                           placeholder="Enter departure station" value="Watford Junction (WFJ)">
                                    <div id="from-suggestions" class="autocomplete-dropdown"></div>
                                </div>
                            </div>
                            
                            <button id="swap-stations" class="swap-button" title="Reverse journey">
                                ‚áÑ
                            </button>
                            
                            <div class="station-input-group">
                                <label for="to-station" class="form-label">To</label>
                                <div class="station-autocomplete">
                                    <input type="text" id="to-station" class="form-control station-input" 
                                           placeholder="Enter destination station" value="London Euston (EUS)">
                                    <div id="to-suggestions" class="autocomplete-dropdown"></div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="journey-controls">
                            <div class="toggle-group">
                                <label class="toggle-label">
                                    <input type="checkbox" id="show-overground" class="toggle-input">
                                    <span class="toggle-slider"></span>
                                    Show London Overground
                                </label>
                            </div>
                            <button id="search-trains" class="btn btn--primary">
                                üîç Search Trains
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Results Display -->
                <div class="results-section">
                    <div id="loading" class="loading hidden">
                        <div class="loading-spinner"></div>
                        <p>Searching for trains...</p>
                    </div>
                    
                    <div id="error" class="error hidden">
                        <h3>Unable to fetch train data</h3>
                        <p id="error-message">Please try a different API method or check the Debug tab for details.</p>
                        <button class="btn btn--secondary" onclick="switchToDebugTab()">Open Debug Tab</button>
                    </div>
                    
                    <div id="results" class="results"></div>
                </div>
            </main>
        </div>

        <!-- Debug Tab Content -->
        <div id="debug-tab" class="tab-content">
            <div class="debug-content">
                <!-- API Testing Section -->
                <div class="debug-section">
                    <h2>üîß API Testing & Debugging</h2>
                    
                    <!-- Manual API Test -->
                    <div class="card debug-card">
                        <div class="card__header">
                            <h3>Manual API Test</h3>
                        </div>
                        <div class="card__body">
                            <div class="debug-form">
                                <div class="form-group">
                                    <label for="debug-from" class="form-label">From Station Code</label>
                                    <input type="text" id="debug-from" class="form-control" value="WFJ" placeholder="e.g., WFJ">
                                </div>
                                
                                <div class="form-group">
                                    <label for="debug-to" class="form-label">To Station Code</label>
                                    <input type="text" id="debug-to" class="form-control" value="EUS" placeholder="e.g., EUS">
                                </div>
                                
                                <div class="form-group">
                                    <label for="debug-method" class="form-label">Test Method</label>
                                    <select id="debug-method" class="form-control">
                                        <option value="direct">Direct API Call</option>
                                        <option value="proxy1">CORS Proxy 1</option>
                                        <option value="proxy2" selected>CORS Proxy 2 (Working)</option>
                                        <option value="proxy3">CORS Proxy 3</option>
                                    </select>
                                </div>
                                
                                <div class="debug-buttons">
                                    <button id="test-api" class="btn btn--primary">Test API Call</button>
                                    <button id="clear-logs" class="btn btn--secondary">Clear Logs</button>
                                    <button id="copy-url" class="btn btn--secondary">Copy Test URL</button>
                                </div>
                            </div>
                            
                            <!-- Generated URL Display -->
                            <div class="url-display">
                                <label class="form-label">Generated API URL:</label>
                                <div class="url-box">
                                    <code id="generated-url">Configure parameters above to see URL</code>
                                    <button class="copy-btn" onclick="copyGeneratedUrl()" title="Copy URL">üìã</button>
                                </div>
                            </div>
                            
                            <!-- External Testing Links -->
                            <div class="external-links">
                                <h4>External Testing</h4>
                                <div class="link-buttons">
                                    <a id="realtimetrains-link" href="#" target="_blank" class="btn btn--info">
                                        üöÜ Test on Realtimetrains.co.uk
                                    </a>
                                    <a href="https://api.rtt.io" target="_blank" class="btn btn--secondary">
                                        üìÑ RTT API Docs
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Live Logging -->
                    <div class="card debug-card">
                        <div class="card__header">
                            <h3>üìã Live API Logs</h3>
                            <div class="log-stats">
                                <span id="log-count" class="log-stat">0 entries</span>
                                <span id="success-rate" class="log-stat">0% success</span>
                            </div>
                        </div>
                        <div class="card__body">
                            <div class="log-filters">
                                <button class="filter-btn active" data-filter="all">All</button>
                                <button class="filter-btn" data-filter="success">Success</button>
                                <button class="filter-btn" data-filter="error">Errors</button>
                                <button class="filter-btn" data-filter="cors">CORS</button>
                            </div>
                            
                            <div id="debug-logs" class="debug-logs">
                                <div class="log-placeholder">
                                    üìÑ API calls will be logged here. Try making a test call above.
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Response Inspector -->
                    <div class="card debug-card">
                        <div class="card__header">
                            <h3>üîç Response Inspector</h3>
                        </div>
                        <div class="card__body">
                            <div class="inspector-tabs">
                                <button class="inspector-tab active" data-tab="headers">Headers</button>
                                <button class="inspector-tab" data-tab="json">JSON Response</button>
                                <button class="inspector-tab" data-tab="parsed">Parsed Data</button>
                            </div>
                            
                            <div id="inspector-content" class="inspector-content">
                                <div class="inspector-placeholder">
                                    Make an API call to see detailed response information
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="app.js"></script>
</body>
</html>